<div id="modalCrearLote" aria-hidden="true" role="dialog" aria-modal="true" style="display:none; z-index:5000;">
    <div class="modal-container">
        <div class="modal-header">
            <h2>Nueva Entrada de Lote</h2>
            <button class="close-btn" type="button" data-close="true" aria-label="Cerrar">&times;</button>
        </div>
        <div class="modal-body">
            <form id="form-crear-lote" class="form-grid" method="post" action="#">
                {% csrf_token %}
                <input type="hidden" name="orden_compra_id" id="id_orden_compra_id" />
                <!-- Producto (componente reutilizable) -->
                {% include 'partials/input_busqueda_producto.html' with input_text_id='buscar_producto_lote' hidden_input_id='id_producto' lista_id='lista-resultados-producto' hidden_input_name='producto' field_name='producto' label='Producto' placeholder='Escribe para buscar...' help_text='Escribe al menos 2 letras y selecciona un producto de la lista.' %}
                <!-- Cantidad de Productos -->
                <div class="form-field" data-field="cantidad_productos">
                    <label for="id_cantidad_productos">Cantidad</label>
                    <input type="number" id="id_cantidad_productos" name="cantidad_productos" min="1" step="1" placeholder="Ej: 500" required>
                    <small class="help-text">Cantidad de unidades en este lote.</small>
                    <div class="error-text" hidden></div>
                </div>
                <!-- Precio del Lote -->
                <div class="form-field" data-field="precio_lote">
                    <label for="id_precio_lote">Precio del Lote</label>
                    <input type="number" id="id_precio_lote" name="precio_lote" min="0" step="1" placeholder="Ej: 12000" required>
                    <small class="help-text">Costo total del lote (moneda base).</small>
                    <div class="error-text" hidden></div>
                </div>
                <!-- Fecha Caducidad (opcional) -->
                <div class="form-field" data-field="fecha_caducidad">
                    <label for="id_fecha_caducidad">Fecha de Caducidad</label>
                    <input type="date" id="id_fecha_caducidad" name="fecha_caducidad" data-fecha-actual="{{ fecha_actual_sistema|date:'Y-m-d' }}" min="{{ fecha_min_caducidad|date:'Y-m-d' }}">
                    <small class="help-text">Opcional. Debe ser a partir de {{ fecha_min_caducidad|date:'d/m/Y' }}.</small>
                    <div class="error-text" hidden></div>
                </div>
                <!-- Nota sobre número de lote -->
                <div class="form-field" data-field="numero_lote_info">
                    <label>Número de Lote</label>
                    <div style="font-size:.65rem; color:#475569; line-height:1.3;">
                        Se generará automáticamente en secuencia para el producto seleccionado.
                    </div>
                </div>
                <!-- Botones -->
                <div class="modal-footer" style="grid-column:1 / -1; display:flex; justify-content:flex-end;">
                    <button type="button" class="btn btn-danger" id="btn-cancelar-lote">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Lote</button>
                </div>
            </form>
        </div><!-- /.modal-body -->
    </div><!-- /.modal-container -->
</div><!-- /#modalCrearLote -->